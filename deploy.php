<!DOCTYPE html>
<html>
<head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# githubog: http://ogp.me/ns/fb/githubog#">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <title>Deploy your site with git</title>

  <meta content="authenticity_token" name="csrf-param" />
<meta content="Lc6FbGYK6qFxOEMjUyGj8m018FyP0NHqY6PYPE8A8I4=" name="csrf-token" />
  <meta name="viewport" content="width=960">


  <link href="https://gist.github.com/assets/application-174d4cf44431e42a0424a5c267403fbe.css" media="screen, print" rel="stylesheet" />
  <script src="https://gist.github.com/assets/application-dbfa091e94e38134d90775e19921c56b.js"></script>

    <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@github">
  <meta name="twitter:creator" content="@oodavid">
  <meta property="og:title" content="README.md">
  <meta property="og:type" content="githubog:gist">
  <meta property="og:url" content="https://gist.github.com/1809044">
  <meta property="og:image" content="https://secure.gravatar.com/avatar/4262055c4f931f97127481d263dd5579?s=140&amp;d=https://github.com/images/gravatars/gravatar-140.png">
  <meta property="og:site_name" content="GitHub Gists">
  <meta property="og:description" content="Deploy your site with git">

  <meta name="description" content="Deploy your site with git">

</head>

<body class="">

  <div id="wrapper">

    <div id="header" class="header header-logged-out">
      <div class="container" class="clearfix">
        <a class="header-logo-wordmark" href="https://gist.github.com/">
          <img alt="GitHub:Gist" class="github-logo-4x" height="30" src="https://gist.github.com/assets/modules/header/logo@4x-d1f04d805ee6b4e58ccbdd0652f915f5.png">
          <img alt="GitHub:Gist" class="github-logo-4x-hover" height="30" src="https://gist.github.com/assets/modules/header/logo@4x-hover-3d1e646ccb5193547b942350f87b068a.png">
        </a>

        <div class="header-actions">
          <a class="button primary classy" href="https://github.com/signup?return_to=gist">Sign up for a GitHub Account</a>
          <a class="button classy" href="/login?return_to=/1809044" data-skip-pjax>Sign in</a>
        </div>
      </div>
    </div>

    <div class="site-content" id="js-pjax-container" data-pjax-container>
      <div class=" site-container js-site-container" data-url="/1809044">
  <div class="pagehead repohead">
  <div class="container">
    <div class="title-actions-bar">
      <ul class="pagehead-actions">
      </ul>
      <h1 itemscope itemtype="http://data-vocabulary.org/Breadcrumb" class="entry-title public">
        <span class="repo-label"><span>public</span></span>
        <span class="mega-icon mega-icon-gist" ></span>
        <div class="meta">
          <div class="gist-author">
            <img src="https://secure.gravatar.com/avatar/4262055c4f931f97127481d263dd5579?s=140&amp;d=https://github.com/images/gravatars/gravatar-140.png" width="26" height="26">
            <span class="author vcard">
                <span itemprop="title"><a href="/oodavid">oodavid</a></span>
            </span> /
            <strong><a href="/1809044" class="js-current-repository">README.md</a></strong>
          </div>
          <div class="gist-timestamp">
              <span class="datetime">Last updated <time class="js-relative-date" title="2012-12-16T15:05:23Z" datetime="2012-12-16T15:05:23Z">2012-12-16</time></span>
              <span class="text"> &mdash; forked from <a href="/1105010">aronwoost/README.md</a></span>
          </div>
      </h1>
    </div>

  </div>
</div>



<div class="gist-description container">
  <p>Deploy your site with git</p>
</div>

<div class="gist container">
    <div class="root-pane">
  <div class="menu-container">
    <ul class="menu gisttabs">
      <li>
        <a href="/1809044" class="selected">
          Gist Detail
        </a>
      </li>

        <li>
          <a href="/1809044/revisions" >
            Revisions
            <span class="counter">13</span>
          </a>
        </li>

        <li>
          <a href="/1809044/stars" >
            Stars
            <span class="counter">44</span>
          </a>
        </li>

        <li>
          <a href="/1809044/forks" >
            Forks
            <span class="counter">18</span>
          </a>
        </li>
    </ul>
  </div>

  <ul class="export-references">
    <li>
      <a href="/1809044/download" class="minibutton" rel="nofollow"><span class="mini-icon mini-icon-download"></span>Download Gist</a>
    </li>
    <li>
      <label for="url-field"><strong>Clone</strong> this gist</label>
      <input type="text" spellcheck="false" class="url-field js-url-field" name="url-field" value="https://gist.github.com/1809044.git">
    </li>
    <li>
      <label for="embed-field"><strong>Embed</strong> this gist</label>
      <input type="text" spellcheck="false" class="url-field js-url-field" name="embed-field" value="&lt;script src=&quot;https://gist.github.com/1809044.js&quot;&gt;&lt;/script&gt;">
    </li>
  </ul>
</div>


  <div class="column files">
        <div id="file-readme-md" class="bubble">
          <div class="file-box ">
            <div class="meta">
              <div class="info">
                <span class="icon mini-icon "></span>
                <strong class="name">README.md</strong>
                <span class="language">Markdown</span>
                <span class="size">4.22 KB</span>
              </div>
              <ul class="button-group actions">
                <li><a title="Bookmark" href="#file-readme-md" class="grouped-button minibutton tooltipped downwards bookmark"><span class="mini-icon mini-icon-link"></span></a></li>
                <li><a title="View Raw" href="/raw/1809044/10e96c987723da94ec94a8132f6314ac338dfe9d/README.md" data-skip-pjax class="grouped-button minibutton tooltipped downwards raw-url"><span class="mini-icon mini-icon-code"></span></a></li>
              </ul>
            </div>
            <div class="suppressed">
              <a class="js-show-suppressed-file">File suppressed. Click to show.</a>
            </div>
            
  <div id="readme">
    <article class="markdown-body">
      <h1>Deploy your site with git</h1>

<p>This gist assumes:</p>

<ul>
<li>you have a local git repo</li>
<li>with an online remote repository (github / bitbucket etc)</li>
<li>and a cloud server (Rackspace cloud / Amazon EC2 etc)

<ul>
<li>your (PHP) scripts are served from /var/www/html/</li>
<li>your webpages are executed by apache</li>
<li>apache's home directory is /var/www/ </li>
<li><strong><em>(this describes a pretty standard apache setup on Redhat / Ubuntu / CentOS / Amazon AMI etc)</em></strong></li>
</ul>
</li>
</ul><p><strong><em>you should be able to do the same with Java, Perl, RoR, JSP etc. however you'll need to recreate the (rather simple) PHP script</em></strong></p>

<h1>1 - On your local machine</h1>

<p><em>Here we add the deployment script and push it to the origin, the deployment script runs git commands to PULL from the origin thus updating your server</em></p>

<h2>Grab a deployment script for your site</h2>

<p>See <a href="#file_deploy.php">deploy.php</a></p>

<h2>Add, commit and push this to github</h2>

<pre><code>git add deploy.php
git commit -m 'Added the git deployment script'
git push -u origin master
</code></pre>

<h1>2 - On your server</h1>

<p><em>Here we install and setup git on the server, we also create an SSH key so the server can talk to the origin without using passwords etc</em></p>

<h2>Install git...</h2>

<p>After you've installed git, make sure it's a relatively new version - old scripts quickly become problematic as github / bitbucket / whatever will have the latests and greatest, if you don't have a recent version you'll need to figure out how to upgrade it :-)</p>

<pre><code>git --version
</code></pre>

<h3>...on CentOS 5.6</h3>

<pre><code># Add a nice repo
rpm -Uvh http://repo.webtatic.com/yum/centos/5/latest.rpm
# Install git
yum install --enablerepo=webtatic git-all
</code></pre>

<h3>...using generic yum</h3>

<pre><code>sudo yum install git-core
</code></pre>

<h2>Setup git</h2>

<pre><code>git config --global user.name "Server"
git config --global user.email "server@server.com"
</code></pre>

<h2>Create an ssh directory for the apache user</h2>

<pre><code>sudo mkdir /var/www/.ssh
sudo chown -R apache:apache /var/www/.ssh/
</code></pre>

<h2>Generate a deploy key for apache user</h2>

<pre><code>sudo -Hu apache ssh-keygen -t rsa # choose "no passphrase"
sudo cat /var/www/.ssh/id_rsa.pub
</code></pre>

<h1>3 - On your origin (github / bitbucket)</h1>

<p><em>Here we add the SSH key to the origin to allow your server to talk without passwords. In the case of GitHub we also setup a post-receive hook which will automatically call the deploy URL thus triggering a PULL request from the server to the origin</em></p>

<h2>GitHub instructions</h2>

<h3>Add the SSH key to your user</h3>

<ol>
<li><a href="https://github.com/settings/ssh">https://github.com/settings/ssh</a></li>
<li>Create a new key</li>
<li>Paste the deploy key you generated on the server</li>
</ol><h3>Set up service hook</h3>

<ol>
<li><a href="https://github.com/oodavid/server.com/admin/hooks">https://github.com/oodavid/server.com/admin/hooks</a></li>
<li>Select the <strong>Post-Receive URL</strong> service hook</li>
<li>Enter the URL to your deployment script - <a href="http://server.com/deploy.php">http://server.com/deploy.php</a>
</li>
<li>Click <strong>Update Settings</strong>
</li>
</ol><h2>Bitbucket instructions</h2>

<h3>Add the SSH key to your account</h3>

<ol>
<li><a href="https://bitbucket.org/account/ssh-keys/">https://bitbucket.org/account/ssh-keys/</a></li>
<li>Create a new key</li>
<li>Paste the deploy key you generated on the server</li>
</ol><h3>Set up service hook</h3>

<ol>
<li>Go to: Repo &gt; Admin &gt; Services</li>
<li>Select "POST"</li>
<li>Add the URL to your deployment script - <a href="http://server.com/deploy.php">http://server.com/deploy.php</a>
</li>
<li>Save</li>
</ol><p><strong><em>Thanks to DrewAPicture in the comments for this one</em></strong></p>

<h1>4 - On the Server</h1>

<p><em>Here we clone the origin repo into a chmodded /var/www/html folder</em></p>

<h2>Pull from origin</h2>

<pre><code>sudo chown -R apache:apache /var/www/html
sudo -Hu apache git clone git@github.com:you/server.git /var/www/html
</code></pre>

<h1>Rejoice!</h1>

<p>Now you're ready to go :-)</p>

<h2>Some notes</h2>

<ul>
<li>Navigate the the deployment script to trigger a pull and see the output:

<ul>
<li><a href="http://server.com/deploy.php">http://server.com/deploy.php</a></li>
<li><strong><em>this is useful for debugging too ;-)</em></strong></li>
<li>When you push to GitHub your site will automatically ping the above url (and pull your code)</li>
<li>When you push to Bitbucket you will need to manually ping the above url</li>
<li>It would be trivial to setup another repo on your server for different branches (develop, release-candidate etc) - repeat most of the steps but checkout a branch after pulling the repo down</li>
</ul>
</li>
</ul><h2>Sources</h2>

<ul>
<li>
<a href="https://gist.github.com/1105010">Build auto-deploy with php and git(hub) on an EC2 Amazon AMI instance</a> - who in turn referenced:

<ul>
<li><a href="https://github.com/rsms/ec2-webapp/blob/master/INSTALL.md#readme">ec2-webapp / INSTALL.md</a></li>
<li><a href="http://writing.markchristian.org/how-to-deploy-your-code-from-github-automatic">How to deploy your code from GitHub automatically</a></li>
</ul>
</li>
</ul>
    </article>
  </div>



          </div>
        </div>
        <div id="file-deploy-php" class="bubble">
          <div class="file-box ">
            <div class="meta">
              <div class="info">
                <span class="icon mini-icon "></span>
                <strong class="name">deploy.php</strong>
                <span class="language">PHP</span>
                <span class="size">1.22 KB</span>
              </div>
              <ul class="button-group actions">
                <li><a title="Bookmark" href="#file-deploy-php" class="grouped-button minibutton tooltipped downwards bookmark"><span class="mini-icon mini-icon-link"></span></a></li>
                <li><a title="View Raw" href="/raw/1809044/424c5f206a9de5900bc4ed900b17d9ffbc4b4f46/deploy.php" data-skip-pjax class="grouped-button minibutton tooltipped downwards raw-url"><span class="mini-icon mini-icon-code"></span></a></li>
              </ul>
            </div>
            <div class="suppressed">
              <a class="js-show-suppressed-file">File suppressed. Click to show.</a>
            </div>
            


  <div class="data">
    <table cellpadding="0" cellspacing="0" class="lines highlight">
      <tr>
        <td class="line_numbers">
          <span id="file-deploy-php-L1" rel="file-deploy-php-L1">1</span>
          <span id="file-deploy-php-L2" rel="file-deploy-php-L2">2</span>
          <span id="file-deploy-php-L3" rel="file-deploy-php-L3">3</span>
          <span id="file-deploy-php-L4" rel="file-deploy-php-L4">4</span>
          <span id="file-deploy-php-L5" rel="file-deploy-php-L5">5</span>
          <span id="file-deploy-php-L6" rel="file-deploy-php-L6">6</span>
          <span id="file-deploy-php-L7" rel="file-deploy-php-L7">7</span>
          <span id="file-deploy-php-L8" rel="file-deploy-php-L8">8</span>
          <span id="file-deploy-php-L9" rel="file-deploy-php-L9">9</span>
          <span id="file-deploy-php-L10" rel="file-deploy-php-L10">10</span>
          <span id="file-deploy-php-L11" rel="file-deploy-php-L11">11</span>
          <span id="file-deploy-php-L12" rel="file-deploy-php-L12">12</span>
          <span id="file-deploy-php-L13" rel="file-deploy-php-L13">13</span>
          <span id="file-deploy-php-L14" rel="file-deploy-php-L14">14</span>
          <span id="file-deploy-php-L15" rel="file-deploy-php-L15">15</span>
          <span id="file-deploy-php-L16" rel="file-deploy-php-L16">16</span>
          <span id="file-deploy-php-L17" rel="file-deploy-php-L17">17</span>
          <span id="file-deploy-php-L18" rel="file-deploy-php-L18">18</span>
          <span id="file-deploy-php-L19" rel="file-deploy-php-L19">19</span>
          <span id="file-deploy-php-L20" rel="file-deploy-php-L20">20</span>
          <span id="file-deploy-php-L21" rel="file-deploy-php-L21">21</span>
          <span id="file-deploy-php-L22" rel="file-deploy-php-L22">22</span>
          <span id="file-deploy-php-L23" rel="file-deploy-php-L23">23</span>
          <span id="file-deploy-php-L24" rel="file-deploy-php-L24">24</span>
          <span id="file-deploy-php-L25" rel="file-deploy-php-L25">25</span>
          <span id="file-deploy-php-L26" rel="file-deploy-php-L26">26</span>
          <span id="file-deploy-php-L27" rel="file-deploy-php-L27">27</span>
          <span id="file-deploy-php-L28" rel="file-deploy-php-L28">28</span>
          <span id="file-deploy-php-L29" rel="file-deploy-php-L29">29</span>
          <span id="file-deploy-php-L30" rel="file-deploy-php-L30">30</span>
          <span id="file-deploy-php-L31" rel="file-deploy-php-L31">31</span>
          <span id="file-deploy-php-L32" rel="file-deploy-php-L32">32</span>
          <span id="file-deploy-php-L33" rel="file-deploy-php-L33">33</span>
          <span id="file-deploy-php-L34" rel="file-deploy-php-L34">34</span>
          <span id="file-deploy-php-L35" rel="file-deploy-php-L35">35</span>
          <span id="file-deploy-php-L36" rel="file-deploy-php-L36">36</span>
          <span id="file-deploy-php-L37" rel="file-deploy-php-L37">37</span>
          <span id="file-deploy-php-L38" rel="file-deploy-php-L38">38</span>
          <span id="file-deploy-php-L39" rel="file-deploy-php-L39">39</span>
          <span id="file-deploy-php-L40" rel="file-deploy-php-L40">40</span>
          <span id="file-deploy-php-L41" rel="file-deploy-php-L41">41</span>
          <span id="file-deploy-php-L42" rel="file-deploy-php-L42">42</span>
          <span id="file-deploy-php-L43" rel="file-deploy-php-L43">43</span>
          <span id="file-deploy-php-L44" rel="file-deploy-php-L44">44</span>
          <span id="file-deploy-php-L45" rel="file-deploy-php-L45">45</span>
          <span id="file-deploy-php-L46" rel="file-deploy-php-L46">46</span>
          <span id="file-deploy-php-L47" rel="file-deploy-php-L47">47</span>
          <span id="file-deploy-php-L48" rel="file-deploy-php-L48">48</span>
          <span id="file-deploy-php-L49" rel="file-deploy-php-L49">49</span>
          <span id="file-deploy-php-L50" rel="file-deploy-php-L50">50</span>
        </td>
        <td class="line_data" width="100%">
          <pre><div class="line" id="file-deploy-php-LC1"><span class="cp">&lt;?php</span></div></pre>
          <pre><div class="line" id="file-deploy-php-LC2">	<span class="sd">/**</span></div></pre>
          <pre><div class="line" id="file-deploy-php-LC3"><span class="sd">	 * GIT DEPLOYMENT SCRIPT</span></div></pre>
          <pre><div class="line" id="file-deploy-php-LC4"><span class="sd">	 *</span></div></pre>
          <pre><div class="line" id="file-deploy-php-LC5"><span class="sd">	 * Used for automatically deploying websites via github or bitbucket, more deets here:</span></div></pre>
          <pre><div class="line" id="file-deploy-php-LC6"><span class="sd">	 *</span></div></pre>
          <pre><div class="line" id="file-deploy-php-LC7"><span class="sd">	 *		https://gist.github.com/1809044</span></div></pre>
          <pre><div class="line" id="file-deploy-php-LC8"><span class="sd">	 */</span></div></pre>
          <pre><div class="line" id="file-deploy-php-LC9">&nbsp;</div></pre>
          <pre><div class="line" id="file-deploy-php-LC10">	<span class="c1">// The commands</span></div></pre>
          <pre><div class="line" id="file-deploy-php-LC11">	<span class="nv">$commands</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span></div></pre>
          <pre><div class="line" id="file-deploy-php-LC12">		<span class="s1">&#39;echo $PWD&#39;</span><span class="p">,</span></div></pre>
          <pre><div class="line" id="file-deploy-php-LC13">		<span class="s1">&#39;whoami&#39;</span><span class="p">,</span></div></pre>
          <pre><div class="line" id="file-deploy-php-LC14">		<span class="s1">&#39;git pull&#39;</span><span class="p">,</span></div></pre>
          <pre><div class="line" id="file-deploy-php-LC15">		<span class="s1">&#39;git status&#39;</span><span class="p">,</span></div></pre>
          <pre><div class="line" id="file-deploy-php-LC16">		<span class="s1">&#39;git submodule sync&#39;</span><span class="p">,</span></div></pre>
          <pre><div class="line" id="file-deploy-php-LC17">		<span class="s1">&#39;git submodule update&#39;</span><span class="p">,</span></div></pre>
          <pre><div class="line" id="file-deploy-php-LC18">		<span class="s1">&#39;git submodule status&#39;</span><span class="p">,</span></div></pre>
          <pre><div class="line" id="file-deploy-php-LC19">	<span class="p">);</span></div></pre>
          <pre><div class="line" id="file-deploy-php-LC20">&nbsp;</div></pre>
          <pre><div class="line" id="file-deploy-php-LC21">	<span class="c1">// Run the commands for output</span></div></pre>
          <pre><div class="line" id="file-deploy-php-LC22">	<span class="nv">$output</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span></div></pre>
          <pre><div class="line" id="file-deploy-php-LC23">	<span class="k">foreach</span><span class="p">(</span><span class="nv">$commands</span> <span class="k">AS</span> <span class="nv">$command</span><span class="p">){</span></div></pre>
          <pre><div class="line" id="file-deploy-php-LC24">		<span class="c1">// Run it</span></div></pre>
          <pre><div class="line" id="file-deploy-php-LC25">		<span class="nv">$tmp</span> <span class="o">=</span> <span class="nb">shell_exec</span><span class="p">(</span><span class="nv">$command</span><span class="p">);</span></div></pre>
          <pre><div class="line" id="file-deploy-php-LC26">		<span class="c1">// Output</span></div></pre>
          <pre><div class="line" id="file-deploy-php-LC27">		<span class="nv">$output</span> <span class="o">.=</span> <span class="s2">&quot;&lt;span style=</span><span class="se">\&quot;</span><span class="s2">color: #6BE234;</span><span class="se">\&quot;</span><span class="s2">&gt;</span><span class="se">\$</span><span class="s2">&lt;/span&gt; &lt;span style=</span><span class="se">\&quot;</span><span class="s2">color: #729FCF;</span><span class="se">\&quot;</span><span class="s2">&gt;</span><span class="si">{</span><span class="nv">$command</span><span class="si">}</span><span class="se">\n</span><span class="s2">&lt;/span&gt;&quot;</span><span class="p">;</span></div></pre>
          <pre><div class="line" id="file-deploy-php-LC28">		<span class="nv">$output</span> <span class="o">.=</span> <span class="nb">htmlentities</span><span class="p">(</span><span class="nx">trim</span><span class="p">(</span><span class="nv">$tmp</span><span class="p">))</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span></div></pre>
          <pre><div class="line" id="file-deploy-php-LC29">	<span class="p">}</span></div></pre>
          <pre><div class="line" id="file-deploy-php-LC30">&nbsp;</div></pre>
          <pre><div class="line" id="file-deploy-php-LC31">	<span class="c1">// Make it pretty for manual user access (and why not?)</span></div></pre>
          <pre><div class="line" id="file-deploy-php-LC32"><span class="cp">?&gt;</span><span class="x"></span></div></pre>
          <pre><div class="line" id="file-deploy-php-LC33"><span class="x">&lt;!DOCTYPE HTML&gt;</span></div></pre>
          <pre><div class="line" id="file-deploy-php-LC34"><span class="x">&lt;html lang=&quot;en-US&quot;&gt;</span></div></pre>
          <pre><div class="line" id="file-deploy-php-LC35"><span class="x">&lt;head&gt;</span></div></pre>
          <pre><div class="line" id="file-deploy-php-LC36"><span class="x">	&lt;meta charset=&quot;UTF-8&quot;&gt;</span></div></pre>
          <pre><div class="line" id="file-deploy-php-LC37"><span class="x">	&lt;title&gt;GIT DEPLOYMENT SCRIPT&lt;/title&gt;</span></div></pre>
          <pre><div class="line" id="file-deploy-php-LC38"><span class="x">&lt;/head&gt;</span></div></pre>
          <pre><div class="line" id="file-deploy-php-LC39"><span class="x">&lt;body style=&quot;background-color: #000000; color: #FFFFFF; font-weight: bold; padding: 0 10px;&quot;&gt;</span></div></pre>
          <pre><div class="line" id="file-deploy-php-LC40"><span class="x">&lt;pre&gt;</span></div></pre>
          <pre><div class="line" id="file-deploy-php-LC41"><span class="x"> .  ____  .    ____________________________</span></div></pre>
          <pre><div class="line" id="file-deploy-php-LC42"><span class="x"> |/      \|   |                            |</span></div></pre>
          <pre><div class="line" id="file-deploy-php-LC43"><span class="x">[| &lt;span style=&quot;color: #FF0000;&quot;&gt;&amp;hearts;    &amp;hearts;&lt;/span&gt; |]  | Git Deployment Script v0.1 |</span></div></pre>
          <pre><div class="line" id="file-deploy-php-LC44"><span class="x"> |___==___|  /              &amp;copy; oodavid 2012 |</span></div></pre>
          <pre><div class="line" id="file-deploy-php-LC45"><span class="x">              |____________________________|</span></div></pre>
          <pre><div class="line" id="file-deploy-php-LC46">&nbsp;</div></pre>
          <pre><div class="line" id="file-deploy-php-LC47"><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$output</span><span class="p">;</span> <span class="cp">?&gt;</span><span class="x"></span></div></pre>
          <pre><div class="line" id="file-deploy-php-LC48"><span class="x">&lt;/pre&gt;</span></div></pre>
          <pre><div class="line" id="file-deploy-php-LC49"><span class="x">&lt;/body&gt;</span></div></pre>
          <pre><div class="line" id="file-deploy-php-LC50"><span class="x">&lt;/html&gt;</span></div></pre>
        </td>
      </tr>
    </table>
  </div>

          </div>
        </div>
      <div id="comments" class="new-comments">
        
<div class="discussion-bubble js-comment-container">
  <img class="discussion-bubble-avatar" width="48" height="48" src="https://secure.gravatar.com/avatar/fa578529649afe19366cc43e1dc34e86?s=140&amp;d=https://github.com/images/gravatars/gravatar-140.png">
  <div class="discussion-bubble-content bubble">
    <div class="discussion-bubble-inner">

      <div class="comment js-comment" id="comment-355597">
        <div class="comment-header normal-comment-header">
          <a href="#" class="comment-type-icon mini-icon mini-icon-commit-comment"></a>
          <a href="DrewAPicture" class="comment-header-author">DrewAPicture</a>
          <span class="comment-header-action-text">
            <span id="gistcomment-355597">
              <a href="/1809044/#comment-355597">commented</a></span>
          </span>
          <span class="comment-header-right">
            <span id="gistcomment-355597">
              <a href="/1809044/#comment-355597" class="comment-header-date">
                <time class="js-relative-date" title="2012-06-21T20:21:54Z" datetime="2012-06-21T20:21:54Z">2012-06-21</time>
              </a>
            </span>
          </span>
        </div>

        <div class="comment-content">
          <div class="edit-comment-hide">
            <!-- <div class="comment-form-error">There has been an error</div> -->
            <div class="comment-body markdown-body markdown-format js-comment-body">
              <p>FYI, I got this to work using BitBucket pretty easily. They may have made allowances for POST requests in the last few months.</p>

<p>On BitBucket, went to the Repo &gt; Admin &gt; Services. Selected POST, dropped in my URL and saved it. Seems to be working as expected.</p>

<p>Thanks for the script, it makes my life a lot easier.</p>
            </div>
          </div>

        </div>
      </div>

    </div>
  </div>
</div>

<div class="discussion-bubble js-comment-container">
  <img class="discussion-bubble-avatar" width="48" height="48" src="https://secure.gravatar.com/avatar/4262055c4f931f97127481d263dd5579?s=140&amp;d=https://github.com/images/gravatars/gravatar-140.png">
  <div class="discussion-bubble-content bubble">
    <div class="discussion-bubble-inner">

      <div class="comment js-comment" id="comment-355599">
        <div class="comment-header normal-comment-header">
          <a href="#" class="comment-type-icon mini-icon mini-icon-commit-comment"></a>
          <a href="oodavid" class="comment-header-author">oodavid</a>
          <span class="comment-header-action-text">
            <span id="gistcomment-355599">
              <a href="/1809044/#comment-355599">commented</a></span>
          </span>
          <span class="comment-header-right">
            <span id="gistcomment-355599">
              <a href="/1809044/#comment-355599" class="comment-header-date">
                <time class="js-relative-date" title="2012-06-21T20:27:14Z" datetime="2012-06-21T20:27:14Z">2012-06-21</time>
              </a>
            </span>
          </span>
        </div>

        <div class="comment-content">
          <div class="edit-comment-hide">
            <!-- <div class="comment-form-error">There has been an error</div> -->
            <div class="comment-body markdown-body markdown-format js-comment-body">
              <p>Glad it helped you out - the real trick for me was getting it so that Apache could play nicely with git...</p>
            </div>
          </div>

        </div>
      </div>

    </div>
  </div>
</div>

<div class="discussion-bubble js-comment-container">
  <img class="discussion-bubble-avatar" width="48" height="48" src="https://secure.gravatar.com/avatar/e94c791f6d5fc2d45de0d418b0031065?s=140&amp;d=https://github.com/images/gravatars/gravatar-140.png">
  <div class="discussion-bubble-content bubble">
    <div class="discussion-bubble-inner">

      <div class="comment js-comment" id="comment-383250">
        <div class="comment-header normal-comment-header">
          <a href="#" class="comment-type-icon mini-icon mini-icon-commit-comment"></a>
          <a href="nebriv" class="comment-header-author">nebriv</a>
          <span class="comment-header-action-text">
            <span id="gistcomment-383250">
              <a href="/1809044/#comment-383250">commented</a></span>
          </span>
          <span class="comment-header-right">
            <span id="gistcomment-383250">
              <a href="/1809044/#comment-383250" class="comment-header-date">
                <time class="js-relative-date" title="2012-07-31T01:29:23Z" datetime="2012-07-31T01:29:23Z">2012-07-31</time>
              </a>
            </span>
          </span>
        </div>

        <div class="comment-content">
          <div class="edit-comment-hide">
            <!-- <div class="comment-form-error">There has been an error</div> -->
            <div class="comment-body markdown-body markdown-format js-comment-body">
              <p>Thanks! it works well for me on shared hosting, without keys!</p>
            </div>
          </div>

        </div>
      </div>

    </div>
  </div>
</div>

<div class="discussion-bubble js-comment-container">
  <img class="discussion-bubble-avatar" width="48" height="48" src="https://secure.gravatar.com/avatar/acacfb410f8da30675c3ad2a22687551?s=140&amp;d=https://github.com/images/gravatars/gravatar-140.png">
  <div class="discussion-bubble-content bubble">
    <div class="discussion-bubble-inner">

      <div class="comment js-comment" id="comment-402882">
        <div class="comment-header normal-comment-header">
          <a href="#" class="comment-type-icon mini-icon mini-icon-commit-comment"></a>
          <a href="bgallagh3r" class="comment-header-author">bgallagh3r</a>
          <span class="comment-header-action-text">
            <span id="gistcomment-402882">
              <a href="/1809044/#comment-402882">commented</a></span>
          </span>
          <span class="comment-header-right">
            <span id="gistcomment-402882">
              <a href="/1809044/#comment-402882" class="comment-header-date">
                <time class="js-relative-date" title="2012-08-21T12:26:14Z" datetime="2012-08-21T12:26:14Z">2012-08-21</time>
              </a>
            </span>
          </span>
        </div>

        <div class="comment-content">
          <div class="edit-comment-hide">
            <!-- <div class="comment-form-error">There has been an error</div> -->
            <div class="comment-body markdown-body markdown-format js-comment-body">
              <p>Just a heads up.  It would be smart to add <code>git reset --hard HEAD</code> in the commands before git pull.  If for some reason your working directory is dirty (files changed, log files created etc) then the deploy will fail.  Resetting the HEAD to the last commit will prevent a deploy failure.</p>
            </div>
          </div>

        </div>
      </div>

    </div>
  </div>
</div>

<div class="discussion-bubble js-comment-container">
  <img class="discussion-bubble-avatar" width="48" height="48" src="https://secure.gravatar.com/avatar/3adf1e302136b4d5a6433e5cef99d4ad?s=140&amp;d=https://github.com/images/gravatars/gravatar-140.png">
  <div class="discussion-bubble-content bubble">
    <div class="discussion-bubble-inner">

      <div class="comment js-comment" id="comment-405092">
        <div class="comment-header normal-comment-header">
          <a href="#" class="comment-type-icon mini-icon mini-icon-commit-comment"></a>
          <a href="mattbanks" class="comment-header-author">mattbanks</a>
          <span class="comment-header-action-text">
            <span id="gistcomment-405092">
              <a href="/1809044/#comment-405092">commented</a></span>
          </span>
          <span class="comment-header-right">
            <span id="gistcomment-405092">
              <a href="/1809044/#comment-405092" class="comment-header-date">
                <time class="js-relative-date" title="2012-08-23T13:43:34Z" datetime="2012-08-23T13:43:34Z">2012-08-23</time>
              </a>
            </span>
          </span>
        </div>

        <div class="comment-content">
          <div class="edit-comment-hide">
            <!-- <div class="comment-form-error">There has been an error</div> -->
            <div class="comment-body markdown-body markdown-format js-comment-body">
              <p>Do you worry about security of the deploy.php script? Is there any harm is someone hits that script, or anything malicious they can do?</p>
            </div>
          </div>

        </div>
      </div>

    </div>
  </div>
</div>

<div class="discussion-bubble js-comment-container">
  <img class="discussion-bubble-avatar" width="48" height="48" src="https://secure.gravatar.com/avatar/0597ffa65c7c8b88fd2ee511ecff6c7c?s=140&amp;d=https://github.com/images/gravatars/gravatar-140.png">
  <div class="discussion-bubble-content bubble">
    <div class="discussion-bubble-inner">

      <div class="comment js-comment" id="comment-559930">
        <div class="comment-header normal-comment-header">
          <a href="#" class="comment-type-icon mini-icon mini-icon-commit-comment"></a>
          <a href="weblance2" class="comment-header-author">weblance2</a>
          <span class="comment-header-action-text">
            <span id="gistcomment-559930">
              <a href="/1809044/#comment-559930">commented</a></span>
          </span>
          <span class="comment-header-right">
            <span id="gistcomment-559930">
              <a href="/1809044/#comment-559930" class="comment-header-date">
                <time class="js-relative-date" title="2012-09-07T11:38:46Z" datetime="2012-09-07T11:38:46Z">2012-09-07</time>
              </a>
            </span>
          </span>
        </div>

        <div class="comment-content">
          <div class="edit-comment-hide">
            <!-- <div class="comment-form-error">There has been an error</div> -->
            <div class="comment-body markdown-body markdown-format js-comment-body">
              <p>got stuck here, any ideas on how to change permissions?</p>

<p>root@staging ~]# sudo -Hu apache ssh-keygen -t rsa # choose "no passphrase"<br>
Generating public/private rsa key pair.<br>
Enter file in which to save the key (/var/www/.ssh/id_rsa): githubkey<br>
Enter passphrase (empty for no passphrase): <br>
Enter same passphrase again: <br>
open githubkey failed: Permission denied.<br>
Saving the key failed: githubkey.</p>
            </div>
          </div>

        </div>
      </div>

    </div>
  </div>
</div>

<div class="discussion-bubble js-comment-container">
  <img class="discussion-bubble-avatar" width="48" height="48" src="https://secure.gravatar.com/avatar/0597ffa65c7c8b88fd2ee511ecff6c7c?s=140&amp;d=https://github.com/images/gravatars/gravatar-140.png">
  <div class="discussion-bubble-content bubble">
    <div class="discussion-bubble-inner">

      <div class="comment js-comment" id="comment-560139">
        <div class="comment-header normal-comment-header">
          <a href="#" class="comment-type-icon mini-icon mini-icon-commit-comment"></a>
          <a href="weblance2" class="comment-header-author">weblance2</a>
          <span class="comment-header-action-text">
            <span id="gistcomment-560139">
              <a href="/1809044/#comment-560139">commented</a></span>
          </span>
          <span class="comment-header-right">
            <span id="gistcomment-560139">
              <a href="/1809044/#comment-560139" class="comment-header-date">
                <time class="js-relative-date" title="2012-09-07T12:39:00Z" datetime="2012-09-07T12:39:00Z">2012-09-07</time>
              </a>
            </span>
          </span>
        </div>

        <div class="comment-content">
          <div class="edit-comment-hide">
            <!-- <div class="comment-form-error">There has been an error</div> -->
            <div class="comment-body markdown-body markdown-format js-comment-body">
              <p>I created a key by skipping the create directory but now i get </p>

<p><code><br>
[root@staging ~]# sudo -Hu apache git clone <a href="mailto:git@github.com">git@github.com</a>:weblance2/primary-trunk.git /var/www/html/<br>
fatal: destination path '/var/www/html' already exists and is not an empty directory.<br></code></p>
            </div>
          </div>

        </div>
      </div>

    </div>
  </div>
</div>

<div class="discussion-bubble js-comment-container">
  <img class="discussion-bubble-avatar" width="48" height="48" src="https://secure.gravatar.com/avatar/791375fcf8f9609edff48f0fae5fb938?s=140&amp;d=https://github.com/images/gravatars/gravatar-140.png">
  <div class="discussion-bubble-content bubble">
    <div class="discussion-bubble-inner">

      <div class="comment js-comment" id="comment-580663">
        <div class="comment-header normal-comment-header">
          <a href="#" class="comment-type-icon mini-icon mini-icon-commit-comment"></a>
          <a href="natxet" class="comment-header-author">natxet</a>
          <span class="comment-header-action-text">
            <span id="gistcomment-580663">
              <a href="/1809044/#comment-580663">commented</a></span>
          </span>
          <span class="comment-header-right">
            <span id="gistcomment-580663">
              <a href="/1809044/#comment-580663" class="comment-header-date">
                <time class="js-relative-date" title="2012-09-29T13:50:23Z" datetime="2012-09-29T13:50:23Z">2012-09-29</time>
              </a>
            </span>
          </span>
        </div>

        <div class="comment-content">
          <div class="edit-comment-hide">
            <!-- <div class="comment-form-error">There has been an error</div> -->
            <div class="comment-body markdown-body markdown-format js-comment-body">
              <p>as <a href="/mattbanks" class="user-mention">@mattbanks</a> says, no security?</p>
            </div>
          </div>

        </div>
      </div>

    </div>
  </div>
</div>

<div class="discussion-bubble js-comment-container">
  <img class="discussion-bubble-avatar" width="48" height="48" src="https://secure.gravatar.com/avatar/bb9d06558f0abc8d10a21fb37d3760db?s=140&amp;d=https://github.com/images/gravatars/gravatar-140.png">
  <div class="discussion-bubble-content bubble">
    <div class="discussion-bubble-inner">

      <div class="comment js-comment" id="comment-585867">
        <div class="comment-header normal-comment-header">
          <a href="#" class="comment-type-icon mini-icon mini-icon-commit-comment"></a>
          <a href="JamesBrooks" class="comment-header-author">JamesBrooks</a>
          <span class="comment-header-action-text">
            <span id="gistcomment-585867">
              <a href="/1809044/#comment-585867">commented</a></span>
          </span>
          <span class="comment-header-right">
            <span id="gistcomment-585867">
              <a href="/1809044/#comment-585867" class="comment-header-date">
                <time class="js-relative-date" title="2012-10-11T22:13:43Z" datetime="2012-10-11T22:13:43Z">2012-10-11</time>
              </a>
            </span>
          </span>
        </div>

        <div class="comment-content">
          <div class="edit-comment-hide">
            <!-- <div class="comment-form-error">There has been an error</div> -->
            <div class="comment-body markdown-body markdown-format js-comment-body">
              <p>This might interest you: JamesBrooks/git-runner (with the git-runner-deploy gem).</p>
            </div>
          </div>

        </div>
      </div>

    </div>
  </div>
</div>

<div class="discussion-bubble js-comment-container">
  <img class="discussion-bubble-avatar" width="48" height="48" src="https://secure.gravatar.com/avatar/bb9d06558f0abc8d10a21fb37d3760db?s=140&amp;d=https://github.com/images/gravatars/gravatar-140.png">
  <div class="discussion-bubble-content bubble">
    <div class="discussion-bubble-inner">

      <div class="comment js-comment" id="comment-585868">
        <div class="comment-header normal-comment-header">
          <a href="#" class="comment-type-icon mini-icon mini-icon-commit-comment"></a>
          <a href="JamesBrooks" class="comment-header-author">JamesBrooks</a>
          <span class="comment-header-action-text">
            <span id="gistcomment-585868">
              <a href="/1809044/#comment-585868">commented</a></span>
          </span>
          <span class="comment-header-right">
            <span id="gistcomment-585868">
              <a href="/1809044/#comment-585868" class="comment-header-date">
                <time class="js-relative-date" title="2012-10-11T22:14:11Z" datetime="2012-10-11T22:14:11Z">2012-10-11</time>
              </a>
            </span>
          </span>
        </div>

        <div class="comment-content">
          <div class="edit-comment-hide">
            <!-- <div class="comment-form-error">There has been an error</div> -->
            <div class="comment-body markdown-body markdown-format js-comment-body">
              <p><a href="https://github.com/JamesBrooks/git-runner">https://github.com/JamesBrooks/git-runner</a> even -.-</p>
            </div>
          </div>

        </div>
      </div>

    </div>
  </div>
</div>

<div class="discussion-bubble js-comment-container">
  <img class="discussion-bubble-avatar" width="48" height="48" src="https://secure.gravatar.com/avatar/7b73618510b0faede263230800301ef6?s=140&amp;d=https://github.com/images/gravatars/gravatar-140.png">
  <div class="discussion-bubble-content bubble">
    <div class="discussion-bubble-inner">

      <div class="comment js-comment" id="comment-608206">
        <div class="comment-header normal-comment-header">
          <a href="#" class="comment-type-icon mini-icon mini-icon-commit-comment"></a>
          <a href="jorijnsmit" class="comment-header-author">jorijnsmit</a>
          <span class="comment-header-action-text">
            <span id="gistcomment-608206">
              <a href="/1809044/#comment-608206">commented</a></span>
          </span>
          <span class="comment-header-right">
            <span id="gistcomment-608206">
              <a href="/1809044/#comment-608206" class="comment-header-date">
                <time class="js-relative-date" title="2012-11-26T11:58:50Z" datetime="2012-11-26T11:58:50Z">2012-11-26</time>
              </a>
            </span>
          </span>
        </div>

        <div class="comment-content">
          <div class="edit-comment-hide">
            <!-- <div class="comment-form-error">There has been an error</div> -->
            <div class="comment-body markdown-body markdown-format js-comment-body">
              <p>I got this working but am missing why I created SSH keys?</p>

<p>If I understand the script correctly anyone can hit the URL (<a href="http://server.com/deploy.php">http://server.com/deploy.php</a>) and it will execute a <code>git pull</code>. How is the difference detected between the GitHub WebHook service and a random visitor or a web crawler?</p>

<p>I think I will do some more digging, I found <a href="https://github.com/Coppertino/github-webhook">https://github.com/Coppertino/github-webhook</a> with a similar function but more advanced options like IP filtering and SSH/FTP support.</p>
            </div>
          </div>

        </div>
      </div>

    </div>
  </div>
</div>

      </div>
      <p class="uncommentable"><span class="mini-icon mini-icon-exclamation"></span> Please <a href="/login?return_to=/1809044" rel="nofollow">sign in</a> to comment on this gist.</p>
  </div>
</div>

  <div class="context-overlay"></div>
</div>

    </div>
    <div class="slow-loading-overlay"></div>
  </div>

  <div id="ajax-error-message" class="flash flash-error">
    <div class="container">
      <span class="mini-icon mini-icon-exclamation"></span>
      Something went wrong with that request. Please try again.
      <a href="#" class="mini-icon mini-icon-remove-close ajax-error-dismiss"></a>
    </div>
  </div>

  <footer>
    <div id="footer">
  <div class="container clearfix">

    <p class="right">&copy; 2012 GitHub Inc. All rights reserved.</p>
    <a class="left" href="/">
      <span class="mega-icon mega-icon-invertocat"></span>
    </a>
    <ul id="legal">
      <li><a href="http://github.com/blog">The GitHub Blog</a></li>
      <li><a href="mailto:support@github.com">Support</a></li>
      <li><a href="https://github.com/contact">Contact</a></li>
    </ul>

  </div><!-- /.container -->
</div><!-- /.#footer -->

  </footer>

</body>
</html>
